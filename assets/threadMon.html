<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="assets/js/resMon.css">
<script type="text/javascript" src="assets/jsLib/svg.min.js">
</script>
<script type="text/javascript" src="assets/jsLib/sprintf.js">
</script>
<script type="text/javascript" src="assets/jsLib/commonTools.js">
</script>
<script type="text/javascript" src="assets/js/bkgSVG.js">
</script>
<script type="text/javascript" src="assets/js/resCurve.js">
</script>
</head>
<body onLoad="taskCurves.OnSubClick(0);" onUnload="top.subUpdater=null;">
<div id="curveList" width="180" align="left" valign="top">
</div>

<div id="divRightHalf">

<div id="divData">
	<font face="宋体" size="1">
	<table border=1 id="dataTable">
	<tr id="trTaskName">
		<td width="10%" align=center colspan=2><font face="黑体">任务名称</font></td>
	</tr>
	<tr id="trCurState">
		<td width="3%" align=center rowspan=3><font face="黑体">状态数据</font></td>
		<td align=center><font face="黑体">任务状态</font></td>
	</tr>
	<tr id="trRunState">
		<td align=center><font face="黑体">运行状态</font></td>
	</tr>
	<tr id="trStatus">
		<td align=center><font face="黑体">仿真状态</font></td>
	</tr>
	<tr id="trSyncTS">
		<td width="3%" align=center rowspan=5><font face="黑体">仿真数据</font></td>
		<td align=center><font face="黑体">同步时戳</font></td>
	</tr>
	<tr id="trSuspendRef">
		<td align=center><font face="黑体">挂起次数（登记）</font></td>
	</tr>
	<tr id="trSuspendNum">
		<td align=center><font face="黑体">挂起次数（Win）</font></td>
	</tr>
	<tr id="trTID">
		<td align=center><font face="黑体">仿真TID</font></td>
	</tr>
	<tr id="trCurCPU">
		<td align=center><font face="黑体">当前CPU</font></td>
	</tr>
	<tr id="trTCBInx">
		<td width="3%" align=center rowspan=6><font face="黑体">基本数据</font></td>
		<td align=center><font face="黑体">TCB号</font></td>
	</tr>
	<tr id="trIsIdle">
		<td align=center><font face="黑体">是否系统Idle</font></td>
	</tr>
	<tr id="trRunTime">
		<td align=center><font face="黑体">累计运行时间</font></td>
	</tr>
	<tr id="trCtxSwitch">
		<td align=center><font face="黑体">任务切换</font></td>
	</tr>
	<tr id="trCurPrio">
		<td align=center><font face="黑体">当前优先级</font></td>
	</tr>
	<tr id="trBasePrio">
		<td align=center><font face="黑体">基本先级</font></td>
	</tr>
	<tr id="trStackSpace">
		<td width="5%" align=center rowspan=5><font face="黑体">内存数据</font></td>
		<td align=center><font face="黑体">栈空间剩余</font></td>
	</tr>
	<tr id="trHeapMax">
		<td align=center><font face="黑体">最大堆占用</font></td>
	</tr>
	<tr id="trHeapCur">
		<td align=center><font face="黑体">当前堆占用</font></td>
	</tr>
	<tr id="trHeapNum">
		<td align=center><font face="黑体">堆分配次数</font></td>
	</tr>
	<tr id="trHeapNumCur">
		<td align=center><font face="黑体">当前堆块数</font></td>
	</tr>
	</table>
	</font>
</div>
<div id="divDetail">
	<iframe id="sDetail" width="100%" height="28%" scrolling="no" frameBorder=0></iframe>
</div>

</div>
<script type="text/javascript">
/*------------------------------------------------------------------
task curve list
------------------------------------------------------------------*/
var taskCurves = top.InitCurveList(top.taskData.activeCurve,60,curveList,sDetail);
/*------------------------------------------------------------------
task data table
------------------------------------------------------------------*/
const taskCurState={start:0, names:[
	"运行", "就绪", "阻塞", "挂起", "删除", "非法"]};
//------------------------------------------------------------------
const taskRunState={start:-2, names:[
	//"调出/taskTASK_YIELDING", "未运行/taskTASK_NOT_RUNNING", "运行"]};
	"调度", "等待", "运行"]};
//------------------------------------------------------------------
const taskStatus={start:0, names:[
    "空", "未知", "初始化", "挂起",
    "运行","同步","退出","错误"]};
//------------------------------------------------------------------
const arrTr  = [trCurState,      trRunState,     trStatus,
                trTaskName,
                trSuspendRef,    trSuspendNum,       trTID,               trCurCPU,
			    trTCBInx,     trIsIdle,        trCurPrio,          trBasePrio,          trRunTime,    trSyncTS,         trCtxSwitch, 
			    trStackSpace, trHeapMax,       trHeapCur,          trHeapNum,           trHeapNumCur];
const arrVar = ["eCurrentState", "xTaskRunState","status",
			    "pcTaskName",
				"suspendRef",    "suspendNum",        "tid",            "curCPU",
				"xTCBInx",    "xIsIdle",       "uxCurrentPriority", "uxBasePriority", "ulRunTimeCounter",  "syncTS",     "uxContextSwitch",
		 "usStackHighWaterMark", "uxMaxMemAlloc", "uxCurMemAlloc",  "uxNumMemAlloc",  "uxNumCurAlloc"];
const arrEnumTempl = [taskCurState,  taskRunState, taskStatus];
//------------------------------------------------------------------
const tidRef           = 6;
const normValStartRef  = 3;
const largeValStartRef = 12;
var   arrCells         = null;
//------------------------------------------------------------------
arrCells = top.InitArrCell(top.taskData.activeCurve.length,arrTr,arrCells);
//------------------------------------------------------------------
function FillOneTask(data,cells)
{
	for(var i=0;i<normValStartRef;i++)
	{
		var val = data[arrVar[i]];
		cells[i].innerHTML = top.FmtEnumValue(arrEnumTempl[i],val);
	}

	for(var i=normValStartRef;i<largeValStartRef;i++)
	{
		var val = data[arrVar[i]];
		cells[i].innerHTML = val;
	}

	for(var i=largeValStartRef;i<cells.length;i++)
	{
		var val = data[arrVar[i]];
		cells[i].innerHTML = FormatSize(val)/*+"/"+val*/;
	}
	
	var val = data[arrVar[tidRef]];
	
	cells[tidRef].innerHTML = sprintf("%d/0x%04x",val,val);
}
//------------------------------------------------------------------
function UpdateDataTable(taskData)
{
	for(var i=0;i<taskData.length;i++)
	{
		var data = taskData[i];
		
		FillOneTask(data,arrCells[i]);
	}
}
/*------------------------------------------------------------------
Sub interface
------------------------------------------------------------------*/
function GetSubInitData(inx)
{
	return top.taskData.activeCurve[inx];
}
//------------------------------------------------------------------
function GetSubTitle(initData,inx)
{
	return initData[top.clRawData].Cur.pcTaskName;
}
//------------------------------------------------------------------
function InitSubValueTitle(valueM0,valueM1,valueM2)
{
	valueM0.innerHTML="CPU使用";
	valueM1.innerHTML="任务切换";
	valueM2.innerHTML="堆使用";
}
/*------------------------------------------------------------------
updater
------------------------------------------------------------------*/
var subUpdater = null;
//------------------------------------------------------------------
function UpdateData()
{
	if(taskCurves.Frames.length<top.taskData.activeCurve.length)
	{
		taskCurves.UpdateList(top.taskData.activeCurve);
		InitArrCell(top.taskData.activeCurve.length, arrTr,arrCells);
	}
		
	taskCurves.Update();
	
	UpdateDataTable(top.taskData.curData);
	
	if(subUpdater)
		subUpdater();
}
//------------------------------------------------------------------
top.ColorTableRows(dataTable,top.defColorPlan);
UpdateData();
parent.subUpdater = UpdateData;
//------------------------------------------------------------------
</script>

</body>
</html>
